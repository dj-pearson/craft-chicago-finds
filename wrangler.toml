name = "craft-chicago-finds"
compatibility_date = "2024-12-19"
pages_build_output_dir = "dist"

# Security: Force HTTPS redirects
[[redirects]]
from = "http://*"
to = "https://:splat"
status = 301
force = true

# ============================================
# SECURITY NOTE: Environment Variables
# ============================================
# IMPORTANT: Sensitive keys should be set via Cloudflare Dashboard:
# Dashboard → Settings → Environment Variables
#
# Required secrets to configure:
# - VITE_SUPABASE_ANON_KEY: Your Supabase anon/public key
# - VITE_STRIPE_PUBLISHABLE_KEY: Your Stripe publishable key
#
# For Supabase Edge Functions, set via Supabase Dashboard:
# - STRIPE_SECRET_KEY: Your Stripe secret key
# - STRIPE_WEBHOOK_SECRET: Stripe webhook signing secret
# - SUPABASE_SERVICE_ROLE_KEY: Service role key for admin operations
# ============================================

# ============================================
# KV Namespace for Distributed Rate Limiting
# ============================================
# IMPORTANT: Create the KV namespace in Cloudflare Dashboard:
# Dashboard → Workers & Pages → KV → Create namespace
# Name: craft-chicago-rate-limit
# Then copy the namespace ID and add it below
#
# The KV binding enables distributed rate limiting across
# all Cloudflare Workers instances. Without this, each
# worker instance maintains its own in-memory rate limit
# store, which can be bypassed by attackers.
# ============================================

# Uncomment and configure once KV namespace is created:
# [[kv_namespaces]]
# binding = "RATE_LIMIT_KV"
# id = "<your-kv-namespace-id>"

# Environment variables for production
# Only non-sensitive values should be listed here
[env.production]
compatibility_date = "2024-12-19"

[env.production.vars]
# VITE_SUPABASE_URL should be set in Cloudflare Dashboard for self-hosted Supabase
# Dashboard → Settings → Environment Variables → Add variable
ENVIRONMENT = "production"
# VITE_SUPABASE_ANON_KEY should be set in Cloudflare Dashboard secrets

# Production KV namespace (uncomment after creating):
# [[env.production.kv_namespaces]]
# binding = "RATE_LIMIT_KV"
# id = "<your-production-kv-namespace-id>"

# Environment variables for preview
[env.preview]
compatibility_date = "2024-12-19"

[env.preview.vars]
# VITE_SUPABASE_URL should be set in Cloudflare Dashboard for self-hosted Supabase
# Dashboard → Settings → Environment Variables → Add variable
ENVIRONMENT = "preview"
# VITE_SUPABASE_ANON_KEY should be set in Cloudflare Dashboard secrets

# Preview KV namespace (uncomment after creating):
# [[env.preview.kv_namespaces]]
# binding = "RATE_LIMIT_KV"
# id = "<your-preview-kv-namespace-id>"
